{% extends 'base.html' %}
{% block content %}
Add new mod
<br>
<label for="mod_name_search">Search for mod by name:</label>
<br>
<input type="text" id='mod_name_search'></input>
<button type='submit' id='mod_search_button'>Search</button>
<div id='results'>
    <table id="resultsTable" border="1" style="margin-top:20px; width:100%; border-collapse: collapse;">
        <thead>
          <tr>
            <th>Mod Name</th>
            <th>Slug</th>
            <th>Description</th>
            <th>Downloads</th>
            <th>Project Page</th>
          </tr>
        </thead>
        <tbody id="resultsBody">
          <!-- Search results will go here -->
        </tbody>
      </table>
</div>
{% endblock content %}

{% block page_scripts %}
<script>
    const resultsBody = document.getElementById('resultsBody');
    const button = document.getElementById("mod_search_button");
    
    const search_text = document.getElementById('mod_name_search');

    const myHeaders = new Headers();
    myHeaders.append('User-Agent', 'mrscopi/mc-modlist/ (contact admin@loottables.app)');
  
    button.addEventListener("click", function() {
        const params = new URLSearchParams();
        params.append("query", search_text.value);
        params.append("limit", 20);
        params.append("facets", '[["categories:fabric"],["server_side:required"],["project_type:mod"],["versions:1.21.5","versions:1.21.6"]]')

        fetch(`https://api.modrinth.com/v2/search?${params}`, {
            method: 'GET',
            headers: myHeaders,
          })
        .then(response => {
        // Check if the request was successful (status code 200-299)
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        // Parse the response as JSON
        return response.json();
        })
        .then(data => {
            renderResults(data.hits);
        })
        .catch(error => {
        // Handle any errors during the fetch operation
        console.error('Error fetching data:', error);
        });
    });

    function renderResults(mods) {
        resultsBody.innerHTML = '';  // Clear previous results
    
        if (mods.length === 0) {
            resultsBody.innerHTML = '<tr><td colspan="5">No results found.</td></tr>';
            return;
        }
    
        mods.forEach(mod => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${mod.title}</td>
                <td>${mod.slug}</td>
                <td>${mod.description || 'No description'}</td>
                <td>${mod.downloads.toLocaleString()}</td>
                <td><a href="https://modrinth.com/mod/${mod.slug}" target="_blank">View</a></td>
            `;
            resultsBody.appendChild(row);
        });
    }

    

</script>
{% endblock page_scripts %}
